{"version":3,"sources":["src/gatsby-node.js"],"names":["publicPath","defaultEnv","defaultOptions","output","query","writeFile","file","data","Promise","resolve","reject","fs","err","runQuery","handler","then","res","errors","Error","join","getOptions","pluginOptions","options","plugins","env","resolveEnv","process","GATSBY_ACTIVE_ENV","NODE_ENV","envOptions","onPostBuild","graphql","pathPrefix","userOptions","mergedOptions","host","Object","prototype","hasOwnProperty","call","site","siteMetadata","siteUrl","sitemap","URL","path","posix","toString","startsWith","policy","configFile","content","filename"],"mappings":"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","sourcesContent":["import fs from 'fs';\nimport robotsTxt from 'generate-robotstxt';\nimport path from 'path';\n\nconst publicPath = './public';\nconst defaultEnv = 'development';\nconst defaultOptions = {\n  output: '/robots.txt',\n  query: `{\n    site {\n      siteMetadata {\n        siteUrl\n      }\n    }\n  }`\n};\n\nfunction writeFile(file, data) {\n  return new Promise((resolve, reject) => {\n    fs.writeFile(file, data, err => {\n      if (err) {\n        reject(err);\n      } else {\n        resolve();\n      }\n    });\n  });\n}\n\nfunction runQuery(handler, query) {\n  return handler(query).then(res => {\n    if (res.errors) {\n      throw new Error(res.errors.join(', '));\n    }\n\n    return res.data;\n  });\n}\n\nconst getOptions = pluginOptions => {\n  const options = { ...pluginOptions };\n\n  delete options.plugins;\n\n  const { env = {}, resolveEnv = () => process.env.GATSBY_ACTIVE_ENV || process.env.NODE_ENV } = options;\n\n  const envOptions = env[resolveEnv()] || env[defaultEnv] || {};\n\n  delete options.env;\n  delete options.resolveEnv;\n\n  return { ...options, ...envOptions };\n};\n\nexport async function onPostBuild({ graphql, pathPrefix = \"\" }, pluginOptions) {\n  const userOptions = getOptions(pluginOptions);\n  const mergedOptions = { ...defaultOptions, ...userOptions };\n\n  if(mergedOptions.host !== null) {\n    if (\n      !Object.prototype.hasOwnProperty.call(mergedOptions, 'host')\n    ) {\n      const {\n        site: {\n          siteMetadata: { siteUrl }\n        }\n      } = await runQuery(graphql, mergedOptions.query);\n  \n      mergedOptions.host = siteUrl;\n    }\n  }\n\n  if(mergedOptions.sitemap !== null) {\n    if (\n      !Object.prototype.hasOwnProperty.call(mergedOptions, 'sitemap')\n    ) {\n  \n      mergedOptions.sitemap = new URL(path.posix.join(pathPrefix, 'sitemap', 'sitemap-index.xml'), mergedOptions.host).toString();\n    } else {\n      try {\n        new URL(mergedOptions.sitemap)\n      } catch {\n        mergedOptions.sitemap = new URL(mergedOptions.sitemap.startsWith(pathPrefix) ? mergedOptions.sitemap : path.posix.join(pathPrefix, mergedOptions.sitemap), mergedOptions.host).toString()\n      }\n    }\n  }\n\n  const { policy, sitemap, host, output, configFile } = mergedOptions;\n\n  const content = await robotsTxt({\n    policy,\n    sitemap,\n    host,\n    configFile\n  });\n  const filename = path.join(publicPath, output);\n\n  return await writeFile(path.resolve(filename), content);\n}\n"],"file":"gatsby-node.js"}